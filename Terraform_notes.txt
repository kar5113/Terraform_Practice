Terraform notes

##### Terraform Variables
1. Variables in Terraform can be defined using the `variable` block and can be referenced using `var.<variable_name>`.
2. Variables can have default values, descriptions, and types (string, number, bool, list, map, etc.).
3. Variables can be overridden using command-line flags, environment variables, or `.tfvars` files.
4. Using variables enhances the reusability and flexibility of Terraform configurations.
5. To get the variables input from the user during runtime, we can define variables without default values.
Example:
```hcl
variable "sg_name" {
  description = "Name of the security group"
  type        = string
}
##
using commmand line  example:
terraform apply -var="sg_name=custom-sg" -var="sg_port=8080" -var='sg_cidr=["0.0.0.0/0"]'
##
using tfvars file example:
Create a file named `custom.tfvars` with the following content:
sg_name = "custom-sg"
sg_port = 8080
sg_cidr = ["0.0.0.0/0"]
Then run:
terraform apply -var-file="custom.tfvars"
## 
using environment variables example:
Set environment variables with the `TF_VAR_` prefix:
export TF_VAR_sg_name="custom-sg"
export TF_VAR_sg_port=8080
export TF_VAR_sg_cidr='["0.0.0.0/0"]'
Then run:
terraform apply 
##
the order of precedence for variable values is:
1. Command-line flags
2. Environment variables
3. `.tfvars` files
4. Default values in the configuration
5. Prompted input during runtime

#### Terraform conditions

1. Terraform supports conditional expressions using the `condition ? true_value : false_value` syntax.
2. Conditional expressions can be used to set variable values, resource attributes, and module inputs based on certain conditions.
3. This allows for dynamic configurations that can adapt based on the environment or other factors.
4. Conditional expressions can be nested for more complex logic.
## Example:
```hcl
variable "environment" {
  description = "The deployment environment"
  type        = string
  default     = "dev"
}
resource "aws_instance" "example" {
  ami           = var.ami-id
  instance_type = var.environment == "dev" ? "t3.micro" : "t3.large"
  tags = {
    Name = var.environment == "dev" ? "terraform-dev-instance" : "terraform-prod-instance"
  }
}
```

#### Terraform loops
1. Terraform supports looping constructs using `for` expressions and `count` meta-argument.
2. `for` expressions can be used to create lists or maps by iterating over collections.
3. The `count` meta-argument allows for the creation of multiple instances of a resource based on a specified number.
4. Loops enhance the ability to manage multiple similar resources efficiently.
## Example using `count` expression:
```hcl
variable "instance_names" {
  description = "List of instance names"
  type        = list(string)
  default     = ["instance1", "instance2", "instance3"]
}
resource "aws_instance" "example" {
  count         = length(var.instance_names)
  ami           = var.ami-id
  instance_type = "t3.micro"
  tags = {
    Name = var.instance_names[count.index]
  }
}
```
## Example using `for` expression:
```hcl
variable "instance_ports" {
  description = "List of instance ports"
  type        = list(number)
  default     = [80, 443, 8080]
}
resource "aws_security_group" "example" {
  name        = "example-sg"
  description = "Example security group"
  vpc_id      = var.vpc-id  
  ingress = [
    for port in var.instance_ports : {
      from_port   = port
      to_port     = port
      protocol    = "tcp"
      cidr_blocks = ["0.0.0.0/0"]
    }
  ]
  egress = [
    {
      from_port   = 0
      to_port     = 0
      protocol    = "-1"
      cidr_blocks = ["0.0.0.0/0"]
    }
  ]
}
```
## Example for each loop: it if for both map and set of strings
```hcl
variable "instance_map" {
  description = "Map of instance names to AMI IDs"
  type        = map(string)
  default     = {
    "instance1" = "ami-0abcdef1234567890"
    "instance2" = "ami-0abcdef1234567891"
    "instance3" = "ami-0abcdef1234567892"
  }
}
resource "aws_instance" "example" {
  for_each      = var.instance_map
  ami           = each.value
  instance_type = "t3.micro"
  tags = {
    Name = each.key
  }
}
```

#### Data Sources in Terraform
1. Data sources in Terraform allow you to fetch and use information from external sources or existing infrastructure.
2. They are defined using the `data` block and can reference various providers to retrieve data.
3. Data sources are read-only and do not create or modify resources.
4. They are useful for obtaining information such as AMI IDs, VPC details, or other resource attributes that are needed for resource creation.
5. Data sources can be used to reference existing resources that were not created by the current Terraform configuration.
## Example:
```hcl
data "aws_ami" "example" {
  most_recent = true
  owners      = ["amazon"]
  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }
}
resource "aws_instance" "example" {
  ami           = data.aws_ami.example.id
  instance_type = "t3.micro"
  tags = {
    Name = "terraform-example-instance"
  }
}
```


#### Functions in Terraform
1. Terraform provides a variety of built-in functions that can be used to manipulate data and perform operations within configurations.
2. Functions can be used for string manipulation, numeric calculations, type conversions, collection operations, and more.
3. Functions enhance the flexibility and dynamism of Terraform configurations by allowing for complex logic and data transformations.
4. Functions are called using the syntax `function_name(arguments)`.
5. Functions can be nested to perform multiple operations in a single expression.
## Example:
```hcl
variable "instance_name" {
  description = "Name of the instance"
  type        = string
  default     = "terraform-example-instance"
}
resource "aws_instance" "example" {
  ami           = var.ami-id
  instance_type = "t3.micro"
  tags = {
    Name = upper(var.instance_name)
  }
}
```
various commonly used functions:
- `upper(string)`: Converts a string to uppercase. ex: upper("hello") => "HELLO"
- `lower(string)`: Converts a string to lowercase. ex: lower("HELLO") => "hello"
- `length(collection)`: Returns the length of a collection (list, map, string). ex: length(["a", "b", "c"]) => 3
- `tolist(value)`: Converts a value to a list. ex: tolist("a,b,c") => ["a", "b", "c"]
- `tomap(value)`: Converts a value to a map. ex: tomap({key1="value1", key2="value2"}) => {key1="value1", key2="value2"}
- `tostring(value)`: Converts a value to a string. ex: tostring(123) => "123"
- `join(separator, list)`: Joins a list of strings into a single string with the specified separator. ex: join("-", ["a", "b", "c"]) => "a-b-c"
- `split(separator, string)`: Splits a string into a list of substrings based on the specified separator. ex: split("-", "a-b-c") => ["a", "b", "c"]
- `lookup(map, key, default)`: Retrieves a value from a map by key, with an optional default if the key does not exist. ex: lookup({key1="value1", key2="value2"}, "key1", "default") => "value1"
- `concat(list1, list2, ...)`: Concatenates multiple lists into a single list. ex: concat(["a", "b"], ["c", "d"]) => ["a", "b", "c", "d"]
- `format(string, args...)`: Formats a string using the specified arguments.  ex: format("Hello, %s!", "World") => "Hello, World!"
- `coalesce(value1, value2, ...)`: Returns the first non-null value from the provided arguments.  data "aws_ami" "ami" {
  most_recent = true
  owners      = ["amazon"]
  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }
}







